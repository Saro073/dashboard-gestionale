<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gestionale</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- EmailJS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1>Dashboard Gestionale</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-full-width">Accedi</button>
                <div id="loginError" class="error-message" ></div>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard-container" >
        <!-- Sidebar Overlay for Mobile -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Dashboard</h2>
                <span id="userDisplay" class="user-badge"></span>
            </div>
            <nav class="sidebar-nav">
                <a href="#overview" class="nav-item active" data-section="overview">
                    <span class="nav-icon">üìä</span>
                    <span>Overview</span>
                </a>
                <a href="#contacts" class="nav-item" data-section="contacts">
                    <span class="nav-icon">üë•</span>
                    <span>Contatti</span>
                </a>
                <a href="#tasks" class="nav-item" data-section="tasks">
                    <span class="nav-icon">‚úì</span>
                    <span>Task</span>
                </a>
                <a href="#notes" class="nav-item" data-section="notes">
                    <span class="nav-icon">üìù</span>
                    <span>Note</span>
                </a>
                <a href="#documents" class="nav-item" data-section="documents">
                    <span class="nav-icon">üìÑ</span>
                    <span>Documenti</span>
                </a>
                <a href="#bookings" class="nav-item" data-section="bookings">
                    <span class="nav-icon">üìÖ</span>
                    <span>Prenotazioni</span>
                </a>
                <!-- Cleaning Section -->
                <a href="#cleaning" class="nav-item" data-section="cleaning" id="cleaningNavItem">
                    <span class="nav-icon">üßπ</span>
                    <span>Pulizie</span>
                </a>
                <!-- Maintenance Section -->
                <a href="#maintenance" class="nav-item" data-section="maintenance" id="maintenanceNavItem">
                    <span class="nav-icon">üîß</span>
                    <span>Manutenzione</span>
                </a>
                <!-- Accounting Section -->
                <a href="#accounting" class="nav-item" data-section="accounting" id="accountingNavItem">
                    <span class="nav-icon">üí∂</span>
                    <span>Contabilit√†</span>
                </a>
                <!-- Analytics Section -->
                <a href="#analytics" class="nav-item" data-section="analytics" id="analyticsNavItem">
                    <span class="nav-icon">üìä</span>
                    <span>Analytics</span>
                </a>
                <!-- Activity Log Section -->
                <a href="#activityLog" class="nav-item" data-section="activityLog" id="activityLogNavItem" >
                    <span class="nav-icon">üìã</span>
                    <span>Registro</span>
                </a>
                <!-- Users Section (Admin Only) -->
                <a href="#users" class="nav-item" data-section="users" id="usersNavItem" >
                    <span class="nav-icon">üîê</span>
                    <span>Utenti</span>
                </a>
                <!-- Category Admin Section (Admin Only) -->
                <a href="#categoryAdmin" class="nav-item" data-section="categoryAdmin" id="categoryAdminNavItem" >
                    <span class="nav-icon">üè∑Ô∏è</span>
                    <span>Categorie</span>
                </a>
                <!-- Settings Section -->
                <a href="#settings" class="nav-item" data-section="settings" id="settingsNavItem">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Impostazioni</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn btn-secondary btn-full-width">Esci</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <button id="menuToggle" class="btn-icon menu-toggle" title="Menu">‚ò∞</button>
                    <h1 id="sectionTitle">Overview</h1>
                </div>
                <div class="header-actions">
                    <button id="backupBtn" class="btn btn-secondary" title="Backup & Ripristino">üíæ</button>
                    <button id="themeToggle" class="btn btn-secondary">üåì</button>
                </div>
            </header>

            <!-- Overview Section -->
            <div id="overviewSection" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card" onclick="Router.navigate('contacts')">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <h3 id="contactsCount">0</h3>
                            <p>Contatti</p>
                        </div>
                    </div>
                    <div class="stat-card" onclick="Router.navigate('tasks')">
                        <div class="stat-icon">‚úì</div>
                        <div class="stat-info">
                            <h3 id="tasksCount">0</h3>
                            <p>Task Attivi</p>
                            <div id="tasksPreview" class="stat-preview"></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="Router.navigate('notes')">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <h3 id="notesCount">0</h3>
                            <p>Note</p>
                            <div id="notesPreview" class="stat-preview"></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="Router.navigate('documents')">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-info">
                            <h3 id="documentsCount">0</h3>
                            <p>Documenti</p>
                        </div>
                    </div>
                    <div class="stat-card" onclick="Router.navigate('bookings')">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-info">
                            <h3 id="bookingsCount">0</h3>
                            <p>Prenotazioni</p>
                            <div id="bookingsPreview" class="stat-preview"></div>
                        </div>
                    </div>
                    <div class="stat-card" onclick="Router.navigate('bookings')">
                        <div class="stat-icon">üîî</div>
                        <div class="stat-info">
                            <h3 id="todayCheckIns">0</h3>
                            <p>Check-in Oggi</p>
                        </div>
                    </div>
                    <div class="stat-card" onclick="Router.navigate('bookings')">
                        <div class="stat-icon">üö∫</div>
                        <div class="stat-info">
                            <h3 id="todayCheckOuts">0</h3>
                            <p>Check-out Oggi</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contacts Section -->
            <div id="contactsSection" class="content-section">
                <div class="section-toolbar">
                    <input type="text" id="contactSearch" class="form-control" placeholder="Cerca contatti...">
                    <select id="contactFilter" class="form-control">
                        <option value="all">Tutti</option>
                        <!-- Popolato dinamicamente da CategoryManager -->
                    </select>
                    <select id="contactSort" class="form-control">
                        <option value="firstName-asc">Nome (A ‚Üí Z)</option>
                        <option value="firstName-desc">Nome (Z ‚Üí A)</option>
                        <option value="lastName-asc">Cognome (A ‚Üí Z)</option>
                        <option value="lastName-desc">Cognome (Z ‚Üí A)</option>
                        <option value="city-asc">Citt√† (A ‚Üí Z)</option>
                        <option value="company-asc">Azienda (A ‚Üí Z)</option>
                        <option value="date-desc">Pi√π recenti</option>
                        <option value="date-asc">Meno recenti</option>
                    </select>
                    <div class="view-toggle-group">
                        <button id="contactViewGrid" class="view-toggle active" title="Vista griglia">
                            <span>‚äû</span>
                        </button>
                        <button id="contactViewList" class="view-toggle" title="Vista lista">
                            <span>‚ò∞</span>
                        </button>
                    </div>
                    <button id="addContactBtn" class="btn btn-primary">+ Aggiungi Contatto</button>
                </div>
                <div id="contactsList" class="items-grid">
                    <p class="empty-state">Nessun contatto presente</p>
                </div>
            </div>

            <!-- Tasks Section -->
            <div id="tasksSection" class="content-section">
                <div class="section-toolbar">
                    <label class="bulk-select-all">
                        <input type="checkbox" id="taskSelectAll">
                        <span>Seleziona tutti</span>
                    </label>
                    <select id="taskFilter" class="form-control">
                        <option value="all">Tutti</option>
                        <option value="active">Attivi</option>
                        <option value="completed">Completati</option>
                    </select>
                    <button id="importTasksBtn" class="btn btn-secondary">üì• Importa CSV</button>
                    <button id="addTaskBtn" class="btn btn-primary">+ Aggiungi Task</button>
                </div>
                
                <!-- Barra azioni bulk -->
                <div id="taskBulkActions" class="bulk-actions-bar" style="display: none;">
                    <span id="taskSelectedCount" class="bulk-count">0 task selezionati</span>
                    <button id="taskBulkDelete" class="btn btn-danger btn-sm">üóëÔ∏è Elimina selezionati</button>
                    <button id="taskBulkCancel" class="btn btn-secondary btn-sm">Annulla</button>
                </div>
                
                <div id="tasksList" class="items-list">
                    <p class="empty-state">Nessun task presente</p>
                </div>
            </div>

            <!-- Notes Section -->
            <div id="notesSection" class="content-section">
                <div class="section-toolbar">
                    <input type="text" id="noteSearch" class="form-control" placeholder="Cerca note...">
                    <select id="noteFilter" class="form-control">
                        <option value="all">Tutte</option>
                        <option value="lavoro">Lavoro</option>
                        <option value="personale">Personale</option>
                        <option value="idee">Idee</option>
                        <option value="generale">Generale</option>
                    </select>
                    <button id="addNoteBtn" class="btn btn-primary">+ Nuova Nota</button>
                </div>
                <div id="notesList" class="items-grid">
                    <p class="empty-state">Nessuna nota presente</p>
                </div>
            </div>

            <!-- Documents Section -->
            <div id="documentsSection" class="content-section">
                <div class="section-toolbar">
                    <input type="text" id="documentSearch" class="form-control" placeholder="Cerca documenti...">
                    <select id="documentFilter" class="form-control">
                        <option value="all">Tutti</option>
                        <option value="contratti">Contratti</option>
                        <option value="fatture">Fatture</option>
                        <option value="reports">Reports</option>
                        <option value="altro">Altro</option>
                    </select>
                    <button id="addDocumentBtn" class="btn btn-primary">+ Carica Documento</button>
                </div>
                <div id="documentsList" class="items-list">
                    <p class="empty-state">Nessun documento presente</p>
                </div>
            </div>

            <!-- Bookings Section -->
            <div id="bookingsSection" class="content-section">
                <div class="section-toolbar">
                    <input type="text" id="bookingSearch" class="form-control" placeholder="Cerca prenotazioni...">
                    <select id="bookingChannelFilter" class="form-control">
                        <option value="all">Tutti i Canali</option>
                        <option value="direct">Diretto</option>
                        <option value="booking">Booking.com</option>
                        <option value="airbnb">Airbnb</option>
                        <option value="vrbo">VRBO</option>
                        <option value="other">Altro</option>
                    </select>
                    <select id="bookingStatusFilter" class="form-control">
                        <option value="all">Tutti gli Stati</option>
                        <option value="confirmed">Confermate</option>
                        <option value="pending">In Attesa</option>
                        <option value="cancelled">Annullate</option>
                        <option value="blocked">Bloccate</option>
                    </select>
                    <div class="view-toggle-group">
                        <button id="calendarViewBtn" class="btn view-toggle active">üìÖ Calendario</button>
                        <button id="listViewBtn" class="btn view-toggle">üìã Lista</button>
                    </div>
                    <button id="addBookingBtn" class="btn btn-primary">+ Nuova Prenotazione</button>
                    <button id="blockDatesBtn" class="btn btn-secondary">üîí Blocca Date</button>
                </div>
                
                <!-- Calendar View -->
                <div id="bookingsCalendarView" class="bookings-view active">
                    <div id="bookingsCalendar"></div>
                </div>
                
                <!-- List View -->
                <div id="bookingsListView" class="bookings-view">
                    <div id="bookingsList" class="items-list">
                        <p class="empty-state">Nessuna prenotazione presente</p>
                    </div>
                </div>
            </div>

            <!-- Cleaning Section -->
            <div id="cleaningSection" class="content-section">
                <!-- Cleaning Stats -->
                <div class="cleaning-stats">
                    <div class="stat-card-small">
                        <span class="stat-label">Programmate</span>
                        <span id="cleaningScheduled" class="stat-number">0</span>
                    </div>
                    <div class="stat-card-small">
                        <span class="stat-label">In Corso</span>
                        <span id="cleaningInProgress" class="stat-number">0</span>
                    </div>
                    <div class="stat-card-small">
                        <span class="stat-label">Completate (30gg)</span>
                        <span id="cleaningCompleted" class="stat-number">0</span>
                    </div>
                    <div class="stat-card-small">
                        <span class="stat-label">Tempo Medio</span>
                        <span id="cleaningAvgDuration" class="stat-number">0 min</span>
                    </div>
                </div>

                <!-- Toolbar -->
                <div class="section-toolbar">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="selectAllCleanings" style="width: 20px; height: 20px; cursor: pointer;">
                        <span>Seleziona tutto</span>
                    </label>
                    <button id="deleteSelectedCleanings" class="btn btn-danger" style="display: none;">üóëÔ∏è Elimina selezionate</button>
                    <input type="text" id="cleaningSearch" class="form-control" placeholder="Cerca pulizie...">
                    <select id="cleaningStatusFilter" class="form-control">
                        <option value="all">Tutti gli Stati</option>
                        <option value="scheduled">Programmate</option>
                        <option value="in-progress">In Corso</option>
                        <option value="completed">Completate</option>
                    </select>
                    <input type="date" id="cleaningDateFilter" class="form-control">
                    <button id="addCleaningBtn" class="btn btn-primary">+ Nuova Pulizia</button>
                </div>

                <!-- Cleanings List -->
                <div id="cleaningList" class="items-list">
                    <p class="empty-state">Nessuna pulizia programmata</p>
                </div>
            </div>

            <!-- Maintenance Section -->
            <div id="maintenanceSection" class="content-section">
                <div class="section-header">
                    <button class="btn btn-primary" id="addMaintenanceBtn">+ Aggiungi Intervento</button>
                </div>

                <!-- Stats Cards -->
                <div class="maintenance-stats">
                    <div class="stat-card-small">
                        <h3>Da Programmare</h3>
                        <p class="stat-value" id="maintenancePending">0</p>
                    </div>
                    <div class="stat-card-small">
                        <h3>In Corso</h3>
                        <p class="stat-value" id="maintenanceInProgress">0</p>
                    </div>
                    <div class="stat-card-small">
                        <h3>üî¥ Urgenti</h3>
                        <p class="stat-value" id="maintenanceUrgent">0</p>
                    </div>
                    <div class="stat-card-small">
                        <h3>Costo Totale (30gg)</h3>
                        <p class="stat-value" id="maintenanceTotalCost">‚Ç¨0</p>
                    </div>
                </div>

                <!-- Filters Toolbar -->
                <div class="section-toolbar">
                    <input type="text" id="maintenanceSearch" class="form-control" placeholder="Cerca intervento...">
                    <select id="maintenanceCategoryFilter" class="form-control">
                        <option value="all">Tutte le categorie</option>
                        <option value="plumbing">üö∞ Idraulica</option>
                        <option value="electrical">‚ö° Elettricit√†</option>
                        <option value="heating">üî• Riscaldamento</option>
                        <option value="locksmith">üîë Serrature</option>
                        <option value="appliances">üîß Elettrodomestici</option>
                        <option value="other">üõ†Ô∏è Altro</option>
                    </select>
                    <select id="maintenanceStatusFilter" class="form-control">
                        <option value="all">Tutti gli stati</option>
                        <option value="pending">Da programmare</option>
                        <option value="in-progress">In corso</option>
                        <option value="completed">Completati</option>
                    </select>
                    <select id="maintenancePriorityFilter" class="form-control">
                        <option value="all">Tutte le priorit√†</option>
                        <option value="urgent">üî¥ Urgente</option>
                        <option value="high">üü† Alta</option>
                        <option value="medium">üü° Media</option>
                        <option value="low">üîµ Bassa</option>
                    </select>
                </div>

                <!-- Maintenance List -->
                <div id="maintenanceList" class="items-list"></div>
            </div>

            <!-- Accounting Section -->
            <div id="accountingSection" class="content-section">
                <!-- Financial Dashboard -->
                <div class="accounting-dashboard">
                    <div class="financial-stats-grid">
                        <div class="financial-stat-card income">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-info">
                                <p class="stat-label">Entrate Totali</p>
                                <h3 id="totalIncome">‚Ç¨0.00</h3>
                            </div>
                        </div>
                        <div class="financial-stat-card expense">
                            <div class="stat-icon">üìâ</div>
                            <div class="stat-info">
                                <p class="stat-label">Uscite Totali</p>
                                <h3 id="totalExpenses">‚Ç¨0.00</h3>
                            </div>
                        </div>
                        <div class="financial-stat-card balance">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-info">
                                <p class="stat-label">Saldo</p>
                                <h3 id="balance">‚Ç¨0.00</h3>
                            </div>
                        </div>
                        <div class="financial-stat-card transactions">
                            <div class="stat-icon">üßæ</div>
                            <div class="stat-info">
                                <p class="stat-label">Transazioni</p>
                                <h3 id="transactionCount">0</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Toolbar -->
                <div class="section-toolbar">
                    <input type="text" id="accountingSearch" class="form-control" placeholder="Cerca transazioni...">
                    <select id="accountingTypeFilter" class="form-control">
                        <option value="all">Tutte</option>
                        <option value="income">Entrate</option>
                        <option value="expense">Uscite</option>
                    </select>
                    <select id="accountingCategoryFilter" class="form-control">
                        <option value="all">Tutte le Categorie</option>
                        <optgroup label="Entrate">
                            <option value="booking">Prenotazione</option>
                            <option value="extra_service">Servizi Extra</option>
                            <option value="deposit">Caparra</option>
                            <option value="other_income">Altro Ricavo</option>
                        </optgroup>
                        <optgroup label="Uscite">
                            <option value="cleaning">Pulizie</option>
                            <option value="maintenance">Manutenzione</option>
                            <option value="utilities">Utenze</option>
                            <option value="commission">Commissioni</option>
                            <option value="insurance">Assicurazione</option>
                            <option value="tax">Tasse</option>
                            <option value="supplies">Forniture</option>
                            <option value="marketing">Marketing</option>
                            <option value="other_expense">Altra Spesa</option>
                        </optgroup>
                    </select>
                    <select id="accountingMonthFilter" class="form-control">
                        <option value="all">Tutti i Mesi</option>
                        <option value="current">Mese Corrente</option>
                        <option value="0">Gennaio</option>
                        <option value="1">Febbraio</option>
                        <option value="2">Marzo</option>
                        <option value="3">Aprile</option>
                        <option value="4">Maggio</option>
                        <option value="5">Giugno</option>
                        <option value="6">Luglio</option>
                        <option value="7">Agosto</option>
                        <option value="8">Settembre</option>
                        <option value="9">Ottobre</option>
                        <option value="10">Novembre</option>
                        <option value="11">Dicembre</option>
                    </select>
                    <button id="exportAccountingCSV" class="btn btn-secondary" title="Esporta CSV">üìä CSV</button>
                    <button id="exportAccountingSummary" class="btn btn-secondary" title="Riepilogo Anno">üìÑ Riepilogo</button>
                    <button id="addTransactionBtn" class="btn btn-primary">+ Nuova Transazione</button>
                </div>

                <!-- Transactions List -->
                <div id="accountingList" class="items-list">
                    <p class="empty-state">Nessuna transazione registrata</p>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="content-section">
                <!-- Period Selector -->
                <div class="analytics-toolbar">
                    <select id="analyticsPeriod" class="form-control">
                        <option value="6">Ultimi 6 Mesi</option>
                        <option value="12" selected>Ultimi 12 Mesi</option>
                        <option value="24">Ultimi 24 Mesi</option>
                        <option value="all">Tutto il Periodo</option>
                    </select>
                    <button id="exportChartsBtn" class="btn btn-secondary">üì∑ Esporta Grafici</button>
                    <button id="refreshAnalyticsBtn" class="btn btn-primary">üîÑ Aggiorna</button>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">üí∞</div>
                        <div class="kpi-content">
                            <p class="kpi-label">Revenue Totale</p>
                            <h3 id="kpiRevenue" class="kpi-value">‚Ç¨0</h3>
                            <span id="kpiRevenueChange" class="kpi-change">-</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üìà</div>
                        <div class="kpi-content">
                            <p class="kpi-label">Tasso Occupazione</p>
                            <h3 id="kpiOccupancy" class="kpi-value">0%</h3>
                            <span id="kpiOccupancyChange" class="kpi-change">-</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üìÖ</div>
                        <div class="kpi-content">
                            <p class="kpi-label">Prenotazioni</p>
                            <h3 id="kpiBookings" class="kpi-value">0</h3>
                            <span id="kpiBookingsChange" class="kpi-change">-</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üíµ</div>
                        <div class="kpi-content">
                            <p class="kpi-label">Revenue Media</p>
                            <h3 id="kpiAvgRevenue" class="kpi-value">‚Ç¨0</h3>
                            <span id="kpiAvgRevenueChange" class="kpi-change">-</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Revenue Trend Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>üìà Trend Entrate/Uscite</h3>
                            <p>Andamento mensile revenue e spese</p>
                        </div>
                        <canvas id="revenueTrendChart"></canvas>
                    </div>

                    <!-- Expense Categories Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>ü•ß Spese per Categoria</h3>
                            <p>Distribuzione delle spese</p>
                        </div>
                        <canvas id="expenseCategoriesChart"></canvas>
                    </div>

                    <!-- Occupancy Rate Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>üìä Tasso di Occupazione</h3>
                            <p>Giorni occupati vs disponibili</p>
                        </div>
                        <canvas id="occupancyChart"></canvas>
                    </div>

                    <!-- Booking Channels Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>üåê Canali di Prenotazione</h3>
                            <p>Distribuzione per canale</p>
                        </div>
                        <canvas id="bookingChannelsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Activity Log Section -->
            <div id="activityLogSection" class="content-section">
                <div class="section-toolbar">
                    <input type="text" id="activityLogSearch" class="form-control" placeholder="Cerca attivit√†...">
                    <select id="activityLogFilter" class="form-control">
                        <option value="all">Tutte le azioni</option>
                        <option value="create">Creazione</option>
                        <option value="update">Modifica</option>
                        <option value="delete">Eliminazione</option>
                        <option value="login">Login</option>
                        <option value="logout">Logout</option>
                    </select>
                    <select id="activityLogEntityFilter" class="form-control">
                        <option value="all">Tutte le entit√†</option>
                        <option value="contact">Contatti</option>
                        <option value="task">Task</option>
                        <option value="note">Note</option>
                        <option value="document">Documenti</option>
                        <option value="booking">Prenotazioni</option>
                        <option value="user">Utenti</option>
                    </select>
                </div>
                <div id="activityLogList" class="items-list">
                    <p class="empty-state">Nessuna attivit√† registrata</p>
                </div>
            </div>

            <!-- Users Section (Admin Only) -->
            <div id="usersSection" class="content-section">
                <div class="section-toolbar">
                    <input type="text" id="userSearch" class="form-control" placeholder="Cerca utenti...">
                    <select id="userRoleFilter" class="form-control">
                        <option value="all">Tutti i Ruoli</option>
                        <option value="admin">Admin</option>
                        <option value="user">Utenti</option>
                    </select>
                    <select id="userStatusFilter" class="form-control">
                        <option value="all">Tutti gli Stati</option>
                        <option value="true">Attivi</option>
                        <option value="false">Disattivati</option>
                    </select>
                    <button id="addUserBtn" class="btn btn-primary">+ Nuovo Utente</button>
                </div>
                <div id="usersList" class="items-list">
                    <p class="empty-state">Nessun utente presente</p>
                </div>
            </div>

            <!-- Category Admin Section (Admin Only) -->
            <div id="categoryAdminSection" class="content-section">
                <div class="section-header">
                    <h2>Gestione Categorie Contatto</h2>
                    <p class="section-description">Amministra le categorie disponibili per i contatti. Puoi eliminare solo le categorie non utilizzate.</p>
                </div>
                
                <!-- Form per creare nuova categoria -->
                <div class="category-create-form">
                    <input 
                        type="text" 
                        id="newCategoryInput" 
                        class="form-control" 
                        placeholder="Nome nuova categoria..."
                        maxlength="50"
                    >
                    <button id="addCategoryBtn" class="btn btn-primary">+ Aggiungi Categoria</button>
                </div>
                
                <div id="categoryAdminList" class="category-admin-list">
                    <p class="empty-state">Nessuna categoria presente</p>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="content-section">
                <div class="section-header">
                    <h1>‚öôÔ∏è Impostazioni Notifiche</h1>
                    <p class="section-description">Configura Telegram e Email per inviare notifiche automatiche</p>
                </div>

                <!-- Telegram Settings -->
                <div class="settings-card">
                    <h2>üí¨ Telegram (Staff Operativo)</h2>
                    <p class="text-secondary">Notifiche istantanee per pulizie e manutenzione</p>
                    
                    <div class="form-group">
                        <label>Bot Token</label>
                        <input type="text" id="telegramBotToken" class="form-control" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                        <small>Ottieni da @BotFather su Telegram</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Chat ID Pulizie</label>
                            <input type="text" id="telegramCleaningChatId" class="form-control" placeholder="123456789">
                            <small>Donna delle pulizie</small>
                        </div>
                        <div class="form-group">
                            <label>Chat ID Manutenzione</label>
                            <input type="text" id="telegramMaintenanceChatId" class="form-control" placeholder="987654321">
                            <small>Tecnico/Manutentore</small>
                        </div>
                        <div class="form-group">
                            <label>Chat ID Admin</label>
                            <input type="text" id="telegramAdminChatId" class="form-control" placeholder="111222333">
                            <small>Notifiche completamenti</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" id="testTelegramBtn">üß™ Test Connessione</button>
                        <button class="btn btn-primary" id="saveTelegramBtn">üíæ Salva Telegram</button>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="settings-card">
                    <h2>üìß Email (Clienti)</h2>
                    <p class="text-secondary">Conferme booking e comunicazioni ufficiali via EmailJS</p>
                    
                    <div class="form-group">
                        <label>Service ID</label>
                        <input type="text" id="emailServiceId" class="form-control" placeholder="service_xxxxxxx">
                        <small>Da dashboard EmailJS</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Template ID</label>
                            <input type="text" id="emailTemplateId" class="form-control" placeholder="template_xxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>Public Key</label>
                            <input type="text" id="emailPublicKey" class="form-control" placeholder="user_xxxxxxxxxxxxxxxxxxxx">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="emailEnabled"> Abilita Email
                        </label>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" id="testEmailBtn">üß™ Test Email</button>
                        <button class="btn btn-primary" id="saveEmailBtn">üíæ Salva Email</button>
                    </div>
                </div>

                <!-- Notification Rules -->
                <div class="settings-card">
                    <h2>üîî Regole Notifiche</h2>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyCleaningCreated" checked> Notifica nuova pulizia creata (Telegram)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyCleaningReminder" checked> Reminder pulizia 2 giorni prima (Telegram)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyMaintenanceCreated" checked> Notifica nuova manutenzione (Telegram)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyMaintenanceUrgent" checked> Alert urgenze immediate (Telegram)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyBookingConfirmation" checked> Email conferma booking (Email)
                        </label>
                    </div>

                    <button class="btn btn-primary" id="saveNotificationRulesBtn">üíæ Salva Regole</button>
                </div>
            </div>

        </main>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2 id="contactModalTitle">Aggiungi Contatto</h2>
                <button class="modal-close" onclick="document.getElementById('contactModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <!-- INFORMAZIONI PERSONALI -->
                    <fieldset class="form-section">
                        <legend>üë§ Informazioni Personali</legend>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="contactFirstName">Nome *</label>
                                <input type="text" id="contactFirstName" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="contactLastName">Cognome</label>
                                <input type="text" id="contactLastName">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="contactCompany">Azienda</label>
                            <input type="text" id="contactCompany">
                        </div>
                        
                        <div class="form-group">
                            <label for="contactCategory">Categoria</label>
                            <input 
                                type="text" 
                                id="contactCategory" 
                                list="contactCategoryList" 
                                placeholder="Seleziona o digita..."
                                autocomplete="off"
                            >
                            <datalist id="contactCategoryList"></datalist>
                            <small class="form-help-text">Digita per creare una nuova categoria</small>
                        </div>
                    </fieldset>
                    
                    <!-- CONTATTI -->
                    <fieldset class="form-section">
                        <legend>üìß Contatti</legend>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <div id="emailsContainer">
                                <div class="multi-input-row">
                                    <input type="email" class="email-value" placeholder="email@esempio.com">
                                    <input type="text" class="email-label" placeholder="Etichetta">
                                    <button type="button" class="btn-remove-field" onclick="app.removeEmailField(this)" title="Rimuovi">‚úï</button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="app.addEmailField()" style="margin-top: 6px;">
                                + Aggiungi Email
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label>Telefono</label>
                            <div id="phonesContainer">
                                <div class="multi-input-row">
                                    <input type="tel" class="phone-value" placeholder="+39 123 456 789">
                                    <input type="text" class="phone-label" placeholder="Etichetta">
                                    <button type="button" class="btn-remove-field" onclick="app.removePhoneField(this)" title="Rimuovi">‚úï</button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="app.addPhoneField()" style="margin-top: 6px;">
                                + Aggiungi Telefono
                            </button>
                        </div>
                    </fieldset>
                    
                    <!-- INDIRIZZO PRIVATO -->
                    <fieldset class="form-section">
                        <legend>üè† Indirizzo Privato</legend>
                        
                        <div class="form-group">
                            <label for="contactAddressStreet">Via</label>
                            <input type="text" id="contactAddressStreet" placeholder="Via, numero civico">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="contactAddressCity">Citt√†</label>
                                <input type="text" id="contactAddressCity">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="contactAddressZip">CAP</label>
                                <input type="text" id="contactAddressZip" maxlength="10">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="contactAddressProvince">Provincia</label>
                                <input type="text" id="contactAddressProvince" maxlength="2" placeholder="es: MI">
                            </div>
                            <div class="form-group" style="flex: 2;">
                                <label for="contactAddressCountry">Paese</label>
                                <input type="text" id="contactAddressCountry" placeholder="es: Italia">
                            </div>
                        </div>
                    </fieldset>
                    
                    <!-- INDIRIZZO AZIENDALE -->
                    <fieldset class="form-section">
                        <legend>üè¢ Indirizzo Aziendale <small style="font-weight: 400; color: var(--text-muted);">(opzionale)</small></legend>
                        
                        <div class="form-group">
                            <label for="contactBusinessAddressStreet">Via</label>
                            <input type="text" id="contactBusinessAddressStreet" placeholder="Via, numero civico">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="contactBusinessAddressCity">Citt√†</label>
                                <input type="text" id="contactBusinessAddressCity">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="contactBusinessAddressZip">CAP</label>
                                <input type="text" id="contactBusinessAddressZip" maxlength="10">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="contactBusinessAddressProvince">Provincia</label>
                                <input type="text" id="contactBusinessAddressProvince" maxlength="2" placeholder="es: MI">
                            </div>
                            <div class="form-group" style="flex: 2;">
                                <label for="contactBusinessAddressCountry">Paese</label>
                                <input type="text" id="contactBusinessAddressCountry" placeholder="es: Italia">
                            </div>
                        </div>
                    </fieldset>
                            <div class="form-group" style="flex: 2;">
                                <label for="contactAddressCountry">Paese</label>
                                <input type="text" id="contactAddressCountry" placeholder="es: Italia">
                            </div>
                        </div>
                    </fieldset>
                    
                    <!-- NOTE -->
                    <fieldset class="form-section">
                        <legend>üìù Note</legend>
                        <div class="form-group">
                            <textarea id="contactNotes" rows="4" placeholder="Aggiungi note o informazioni aggiuntive..."></textarea>
                        </div>
                    </fieldset>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('contactModal').classList.remove('active')">Annulla</button>
                        <button type="submit" class="btn btn-primary">Salva</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- CSV Import Modal -->
    <div id="importCSVModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üì• Importa Task da CSV</h2>
                <button class="modal-close" onclick="document.getElementById('importCSVModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-instructions">
                    <h3>üìã Formato CSV Supportato</h3>
                    <p>Il file CSV deve seguire il formato della Roadmap:</p>
                    <code>Done, Priorit√†, Stato, Periodo, Attivit√†</code>
                    <ul>
                        <li><strong>Done:</strong> true/false o checkbox (‚úì, x, 1, 0)</li>
                        <li><strong>Priorit√†:</strong> Bassa, Media, Alta, Critica</li>
                        <li><strong>Stato:</strong> Emoji (‚úÖ, üîÑ, ‚ùå, ‚è∏Ô∏è) o testo</li>
                        <li><strong>Periodo:</strong> "09-15 Dicembre 2025" o "Q1 2026"</li>
                        <li><strong>Attivit√†:</strong> Titolo task con tag [CATEGORIA] opzionali</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="csvFileInput">Seleziona file CSV</label>
                    <input type="file" id="csvFileInput" accept=".csv,text/csv" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="importMergeMode" checked>
                        Salta duplicati (merge mode)
                    </label>
                    <small>Se attivo, i task con stesso titolo non saranno reimportati</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="importAssignToMe" checked>
                        Assegna tutti i task a me
                    </label>
                </div>
                
                <div id="importPreviewContainer" style="display: none;">
                    <h3>üëÅÔ∏è Anteprima Import</h3>
                    <div id="importPreview"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('importCSVModal').classList.remove('active')">Annulla</button>
                <button type="button" id="confirmImportBtn" class="btn btn-primary" disabled>Importa Task</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="taskModalTitle">Aggiungi Task</h2>
                <button class="modal-close" onclick="document.getElementById('taskModal').classList.remove('active')">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskTitle">Titolo *</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription">Descrizione</label>
                    <textarea id="taskDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskPriority">Priorit√†</label>
                    <select id="taskPriority">
                        <option value="bassa">Bassa</option>
                        <option value="media" selected>Media</option>
                        <option value="alta">Alta</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskStatus">Stato</label>
                    <select id="taskStatus">
                        <option value="todo" selected>Da fare</option>
                        <option value="in-progress">In corso</option>
                        <option value="paused">In pausa</option>
                        <option value="completed">Completato</option>
                        <option value="cancelled">Annullato</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskDueDate">Scadenza</label>
                    <input type="date" id="taskDueDate">
                </div>
                
                <!-- ALLEGATI -->
                <div class="form-group">
                    <label for="taskAttachments">Allegati (opzionale)</label>
                    <input type="file" id="taskAttachments" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.png,.jpg,.jpeg,.zip">
                    <small>Max 5MB per file - PDF, DOC, XLS, TXT, IMG, ZIP</small>
                </div>
                
                <!-- Lista allegati esistenti (in modalit√† edit) -->
                <div id="taskAttachmentsList" >
                    <label>Allegati attuali:</label>
                    <div id="taskCurrentAttachments" class="attachments-list"></div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('taskModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="noteModalTitle">Nuova Nota</h2>
                <button class="modal-close" onclick="document.getElementById('noteModal').classList.remove('active')">&times;</button>
            </div>
            <form id="noteForm">
                <div class="form-group">
                    <label for="noteTitle">Titolo *</label>
                    <input type="text" id="noteTitle" required>
                </div>
                <div class="form-group">
                    <label for="noteContent">Contenuto *</label>
                    <textarea id="noteContent" rows="6" required></textarea>
                </div>
                <div class="form-group">
                    <label for="noteCategory">Categoria</label>
                    <select id="noteCategory">
                        <option value="generale">Generale</option>
                        <option value="lavoro">Lavoro</option>
                        <option value="personale">Personale</option>
                        <option value="idee">Idee</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="noteUrgent">
                        <span>üö® Segna come urgente</span>
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('noteModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Document Modal -->
    <div id="documentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Carica Documento</h2>
                <button class="modal-close" onclick="document.getElementById('documentModal').classList.remove('active')">&times;</button>
            </div>
            <form id="documentForm">
                <div class="form-group">
                    <label for="documentFile">File *</label>
                    <input type="file" id="documentFile" required>
                    <small>Max 5MB - Formati: PDF, DOC, XLS, PPT, TXT, CSV, IMG, ZIP</small>
                </div>
                <div class="form-group">
                    <label for="documentCategory">Categoria</label>
                    <select id="documentCategory">
                        <option value="altro">Altro</option>
                        <option value="contratti">Contratti</option>
                        <option value="fatture">Fatture</option>
                        <option value="reports">Reports</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="documentDescription">Descrizione</label>
                    <textarea id="documentDescription" rows="2"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('documentModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Carica</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="bookingModalTitle">Nuova Prenotazione</h2>
                <button class="modal-close" onclick="document.getElementById('bookingModal').classList.remove('active')">&times;</button>
            </div>
            <form id="bookingForm">
                <!-- Autocomplete Cliente Esistente -->
                <div class="form-group">
                    <label for="bookingSearchContact">üîç Cerca Cliente Esistente (opzionale)</label>
                    <input type="text" id="bookingSearchContact" placeholder="Digita nome, email o telefono..." autocomplete="off">
                    <div id="bookingContactSuggestions" class="autocomplete-suggestions" style="display:none;"></div>
                    <small class="form-hint">Se trovi il cliente, i dati verranno pre-compilati automaticamente</small>
                </div>
                
                <hr style="margin: 1rem 0; border: 1px solid var(--border-color);">
                
                <!-- Dati Ospite -->
                <h3 style="margin-bottom: 1rem;">Dati Ospite</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingGuestFirstName">Nome *</label>
                        <input type="text" id="bookingGuestFirstName" required minlength="1">
                    </div>
                    <div class="form-group">
                        <label for="bookingGuestLastName">Cognome</label>
                        <input type="text" id="bookingGuestLastName">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingGuestEmail">Email</label>
                        <input type="email" id="bookingGuestEmail">
                    </div>
                    <div class="form-group">
                        <label for="bookingGuestPhone">Telefono</label>
                        <input type="tel" id="bookingGuestPhone">
                    </div>
                </div>
                
                <!-- Indirizzo Privato -->
                <details style="margin-bottom: 1rem;">
                    <summary style="cursor: pointer; font-weight: 600; margin-bottom: 0.5rem;">üìç Indirizzo Privato (opzionale)</summary>
                    <div class="form-group">
                        <label for="bookingPrivateStreet">Via</label>
                        <input type="text" id="bookingPrivateStreet">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bookingPrivateZip">CAP</label>
                            <input type="text" id="bookingPrivateZip">
                        </div>
                        <div class="form-group">
                            <label for="bookingPrivateCity">Citt√†</label>
                            <input type="text" id="bookingPrivateCity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bookingPrivateCountry">Paese</label>
                        <input type="text" id="bookingPrivateCountry" value="Italia">
                    </div>
                </details>
                
                <!-- Indirizzo Aziendale -->
                <details style="margin-bottom: 1rem;">
                    <summary style="cursor: pointer; font-weight: 600; margin-bottom: 0.5rem;">üè¢ Indirizzo Aziendale (opzionale)</summary>
                    <div class="form-group">
                        <label for="bookingBusinessStreet">Via</label>
                        <input type="text" id="bookingBusinessStreet">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bookingBusinessZip">CAP</label>
                            <input type="text" id="bookingBusinessZip">
                        </div>
                        <div class="form-group">
                            <label for="bookingBusinessCity">Citt√†</label>
                            <input type="text" id="bookingBusinessCity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bookingBusinessCountry">Paese</label>
                        <input type="text" id="bookingBusinessCountry" value="Italia">
                    </div>
                </details>
                
                <hr style="margin: 1rem 0; border: 1px solid var(--border-color);">
                
                <!-- Dati Prenotazione -->
                <h3 style="margin-bottom: 1rem;">Dati Prenotazione</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingCheckIn">Check-in *</label>
                        <input type="date" id="bookingCheckIn" required>
                    </div>
                    <div class="form-group">
                        <label for="bookingCheckOut">Check-out *</label>
                        <input type="date" id="bookingCheckOut" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingGuests">Numero Ospiti *</label>
                        <input type="number" id="bookingGuests" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="bookingChannel">Canale</label>
                        <select id="bookingChannel">
                            <option value="direct">Diretto</option>
                            <option value="booking">Booking.com</option>
                            <option value="airbnb">Airbnb</option>
                            <option value="vrbo">VRBO</option>
                            <option value="other">Altro</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingTotalAmount">Importo Totale (‚Ç¨)</label>
                        <input type="number" id="bookingTotalAmount" min="0" step="0.01" value="0">
                    </div>
                    <div class="form-group">
                        <label for="bookingDeposit">Acconto (‚Ç¨)</label>
                        <input type="number" id="bookingDeposit" min="0" step="0.01" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingStatus">Stato</label>
                        <select id="bookingStatus">
                            <option value="confirmed">Confermata</option>
                            <option value="pending">In Attesa</option>
                            <option value="cancelled">Annullata</option>
                            <option value="blocked">Bloccata</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="bookingIsPaid"> Pagato
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="bookingNotes">Note</label>
                    <textarea id="bookingNotes" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('bookingModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Block Dates Modal -->
    <div id="blockDatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Blocca Date</h2>
                <button class="modal-close" onclick="document.getElementById('blockDatesModal').classList.remove('active')">&times;</button>
            </div>
            <form id="blockDatesForm">
                <div class="form-group">
                    <label for="blockStartDate">Data Inizio *</label>
                    <input type="date" id="blockStartDate" required>
                </div>
                <div class="form-group">
                    <label for="blockEndDate">Data Fine *</label>
                    <input type="date" id="blockEndDate" required>
                </div>
                <div class="form-group">
                    <label for="blockReason">Motivo</label>
                    <textarea id="blockReason" rows="3" placeholder="Es: Manutenzione, Uso personale..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('blockDatesModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Blocca</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Calendar Action Menu Modal -->
    <div id="calendarActionMenu" class="modal calendar-action-modal">
        <div class="modal-content action-menu-content">
            <div class="modal-header">
                <h2>Cosa vuoi fare?</h2>
                <button class="modal-close" onclick="CalendarComponent.closeActionMenu()">&times;</button>
            </div>
            <div class="action-menu-summary">
                <div class="summary-dates">
                    <span class="summary-label">Check-in:</span>
                    <strong id="actionMenuCheckIn">-</strong>
                    <span class="summary-separator">‚Üí</span>
                    <span class="summary-label">Check-out:</span>
                    <strong id="actionMenuCheckOut">-</strong>
                </div>
                <div class="summary-nights">
                    <span class="nights-badge" id="actionMenuNights">0 notti</span>
                </div>
            </div>
            <div class="action-menu-buttons">
                <button class="action-btn action-btn-primary" onclick="CalendarComponent.actionNewBooking()">
                    <span class="action-icon">üìÖ</span>
                    <span class="action-text">
                        <strong>Nuova Prenotazione</strong>
                        <small>Crea una prenotazione per queste date</small>
                    </span>
                </button>
                <button class="action-btn action-btn-secondary" onclick="CalendarComponent.actionBlockDates()">
                    <span class="action-icon">üîí</span>
                    <span class="action-text">
                        <strong>Blocca Date</strong>
                        <small>Rendi non disponibili queste date</small>
                    </span>
                </button>
                <div id="existingBookingActions" style="display: none;">
                    <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--border-color);">
                    <button class="action-btn action-btn-edit" onclick="CalendarComponent.actionEditBooking()">
                        <span class="action-icon">‚úèÔ∏è</span>
                        <span class="action-text">
                            <strong>Modifica Prenotazione</strong>
                            <small>Modifica la prenotazione esistente</small>
                        </span>
                    </button>
                    <button class="action-btn action-btn-danger" onclick="CalendarComponent.actionDeleteBooking()">
                        <span class="action-icon">üóëÔ∏è</span>
                        <span class="action-text">
                            <strong>Elimina Prenotazione</strong>
                            <small>Rimuovi completamente la prenotazione</small>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Modal (Admin Only) -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userModalTitle">Nuovo Utente</h2>
                <button class="modal-close" onclick="document.getElementById('userModal').classList.remove('active')">&times;</button>
            </div>
            <form id="userForm">
                <div class="form-group">
                    <label for="userUsername">Username *</label>
                    <input type="text" id="userUsername" required minlength="3" maxlength="30">
                </div>
                <div class="form-group">
                    <label for="userPassword">Password *</label>
                    <input type="password" id="userPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="userFullName">Nome Completo</label>
                    <input type="text" id="userFullName">
                </div>
                <div class="form-group">
                    <label for="userEmail">Email</label>
                    <input type="email" id="userEmail">
                </div>
                <div class="form-group">
                    <label for="userRole">Ruolo *</label>
                    <select id="userRole" required>
                        <option value="user">Utente</option>
                        <option value="admin">Amministratore</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('userModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2 id="transactionModalTitle">Nuova Transazione</h2>
                <button class="modal-close" onclick="document.getElementById('transactionModal').classList.remove('active')">&times;</button>
            </div>
            <form id="transactionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="transactionType">Tipo *</label>
                        <select id="transactionType" required>
                            <option value="income">Entrata</option>
                            <option value="expense">Uscita</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionAmount">Importo (‚Ç¨) *</label>
                        <input type="number" id="transactionAmount" min="0.01" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="transactionCategory">Categoria *</label>
                        <select id="transactionCategory" required>
                            <optgroup label="Entrate" id="incomeCategoriesGroup">
                                <option value="booking">Prenotazione</option>
                                <option value="extra_service">Servizi Extra</option>
                                <option value="deposit">Caparra</option>
                                <option value="other_income">Altro Ricavo</option>
                            </optgroup>
                            <optgroup label="Uscite" id="expenseCategoriesGroup" style="display:none">
                                <option value="cleaning">Pulizie</option>
                                <option value="maintenance">Manutenzione</option>
                                <option value="utilities">Utenze</option>
                                <option value="commission">Commissioni</option>
                                <option value="insurance">Assicurazione</option>
                                <option value="tax">Tasse</option>
                                <option value="supplies">Forniture</option>
                                <option value="marketing">Marketing</option>
                                <option value="other_expense">Altra Spesa</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionDate">Data *</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionDescription">Descrizione *</label>
                    <input type="text" id="transactionDescription" required placeholder="Es: Pagamento prenotazione dicembre">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="transactionPaymentMethod">Metodo Pagamento</label>
                        <select id="transactionPaymentMethod">
                            <option value="cash">Contanti</option>
                            <option value="card">Carta</option>
                            <option value="bank_transfer">Bonifico</option>
                            <option value="paypal">PayPal</option>
                            <option value="stripe">Stripe</option>
                            <option value="other">Altro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionReceiptNumber">N¬∞ Ricevuta/Fattura</label>
                        <input type="text" id="transactionReceiptNumber" placeholder="Es: FAT-2024-001">
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionNotes">Note</label>
                    <textarea id="transactionNotes" rows="3" placeholder="Note aggiuntive..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('transactionModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Backup/Restore Modal -->
    <div id="backupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíæ Backup & Ripristino</h2>
                <button class="modal-close" onclick="document.getElementById('backupModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="backup-section">
                    <h3>Crea Backup</h3>
                    <p>Scarica un backup completo di tutti i dati (contatti, prenotazioni, contabilit√†, ecc.)</p>
                    <button id="downloadBackupBtn" class="btn btn-primary" style="width: 100%;">
                        üì• Scarica Backup
                    </button>
                </div>
                
                <div class="backup-divider" style="margin: 2rem 0; border-top: 1px solid var(--border-color);"></div>
                
                <div class="backup-section">
                    <h3>Ripristina Backup</h3>
                    <p class="text-danger" style="margin-bottom: 1rem;">
                        ‚ö†Ô∏è ATTENZIONE: Ripristinare un backup sovrascriver√† TUTTI i dati attuali!
                    </p>
                    <input type="file" id="backupFileInput" accept=".json" style="display: none;">
                    <button id="selectBackupFileBtn" class="btn btn-secondary" style="width: 100%;">
                        üì§ Seleziona File Backup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cleaning Modal -->
    <div id="cleaningModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="cleaningModalTitle">Nuova Pulizia</h2>
                <button class="modal-close" onclick="document.getElementById('cleaningModal').classList.remove('active')">&times;</button>
            </div>
            <form id="cleaningForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="cleaningDate">Data Pulizia *</label>
                        <input type="date" id="cleaningDate" required>
                    </div>
                    <div class="form-group">
                        <label for="cleaningTime">Orario</label>
                        <input type="time" id="cleaningTime" value="14:00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cleaningGuestName">Cliente</label>
                        <input type="text" id="cleaningGuestName" placeholder="Nome ospite (opzionale)">
                    </div>
                    <div class="form-group">
                        <label for="cleaningBookingId">ID Prenotazione</label>
                        <input type="number" id="cleaningBookingId" placeholder="ID prenotazione">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cleaningAssignedTo">Assegnata a</label>
                        <select id="cleaningAssignedTo">
                            <option value="">Non assegnata</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cleaningPriority">Priorit√†</label>
                        <select id="cleaningPriority">
                            <option value="low">Bassa</option>
                            <option value="normal" selected>Normale</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cleaningDuration">Durata Stimata (min)</label>
                        <input type="number" id="cleaningDuration" value="120" min="30" step="15">
                    </div>
                    <div class="form-group">
                        <label for="cleaningCost">Costo (‚Ç¨)</label>
                        <input type="number" id="cleaningCost" value="40" min="0" step="5">
                    </div>
                </div>
                <div class="form-group">
                    <label for="cleaningNotes">Note</label>
                    <textarea id="cleaningNotes" rows="3" placeholder="Note aggiuntive..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('cleaningModal').classList.remove('active')">Annulla</button>
                    <button type="submit" class="btn btn-primary">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cleaning Checklist Modal -->
    <div id="checklistModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="checklistModalTitle">Checklist Pulizia</h2>
                <button class="modal-close" onclick="document.getElementById('checklistModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Progress Bar -->
                <div class="checklist-progress">
                    <div class="progress-bar">
                        <div id="checklistProgressBar" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span id="checklistProgressText" class="progress-text">0% Completato</span>
                </div>

                <!-- Checklist Items by Category -->
                <div id="checklistItems">
                    <!-- Populated dynamically -->
                </div>

                <!-- Actions -->
                <div class="checklist-actions" style="margin-top: 2rem; display: flex; gap: 1rem;">
                    <button id="startCleaningBtn" class="btn btn-success">‚ñ∂Ô∏è Inizia Pulizia</button>
                    <button id="completeCleaningBtn" class="btn btn-primary">‚úÖ Completa Pulizia</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('checklistModal').classList.remove('active')">Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div id="maintenanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="maintenanceModalTitle">Nuovo Intervento</h2>
                <button class="modal-close" onclick="document.getElementById('maintenanceModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="maintenanceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Categoria *</label>
                            <select id="maintenanceCategory" class="form-control" required>
                                <option value="">Seleziona...</option>
                                <option value="plumbing">üö∞ Idraulica</option>
                                <option value="electrical">‚ö° Elettricit√†</option>
                                <option value="heating">üî• Riscaldamento/Caldaia</option>
                                <option value="locksmith">üîë Serrature</option>
                                <option value="appliances">üîß Elettrodomestici</option>
                                <option value="other">üõ†Ô∏è Altro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priorit√† *</label>
                            <select id="maintenancePriority" class="form-control" required>
                                <option value="medium">üü° Media</option>
                                <option value="low">üîµ Bassa</option>
                                <option value="high">üü† Alta</option>
                                <option value="urgent">üî¥ Urgente</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Descrizione Problema *</label>
                        <textarea id="maintenanceDescription" class="form-control" rows="3" required placeholder="Descrivi il problema..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Data Richiesta</label>
                            <input type="date" id="maintenanceRequestDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Data Programmata</label>
                            <input type="date" id="maintenanceScheduledDate" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Assegnato a</label>
                            <input type="text" id="maintenanceAssignedTo" class="form-control" placeholder="Nome tecnico">
                        </div>
                        <div class="form-group">
                            <label>Costo Stimato (‚Ç¨)</label>
                            <input type="number" id="maintenanceEstimatedCost" class="form-control" step="0.01" min="0" value="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Note</label>
                        <textarea id="maintenanceNotes" class="form-control" rows="2" placeholder="Note aggiuntive..."></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('maintenanceModal').classList.remove('active')">Annulla</button>
                        <button type="submit" class="btn btn-primary">üíæ Salva</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts: ORDINE CRITICO! -->
    <!-- 1. Configurazione -->
    <script src="js/config.js"></script>
    
    <!-- 2. Core Architecture -->
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/Router.js"></script>
    
    <!-- 3. Services -->
    <script src="js/storage.js"></script>
    <script src="js/services/NotificationService.js"></script>
    <script src="js/utils.js"></script>
    
    <!-- 4. Autenticazione -->
    <script src="js/auth/users.js"></script>
    <script src="js/auth/auth.js"></script>
    <script src="js/auth/permissions.js"></script>
    
    <!-- 5. Moduli -->
    <script src="js/modules/activity-log.js"></script>
    <script src="js/modules/categories.js"></script>
    <script src="js/modules/contacts.js"></script>
    <script src="js/modules/tasks.js"></script>
    <script src="js/modules/import-csv.js"></script>
    <script src="js/modules/notes.js"></script>
    <script src="js/modules/documents.js"></script>
    <script src="js/modules/bookings.js"></script>
    <script src="js/modules/cleaning.js"></script>
    <script src="js/modules/maintenance.js"></script>
    <script src="js/modules/accounting.js"></script>
    <script src="js/modules/analytics.js"></script>
    <script src="js/modules/backup.js"></script>
    <script src="js/modules/users-management.js"></script>
    
    <!-- 5b. Services -->
    <script src="js/services/TelegramService.js"></script>
    <script src="js/services/EmailService.js"></script>
    
    <!-- 6. Componenti -->
    <script src="js/components/calendar.js"></script>
    
    <!-- 7. Handlers -->
    <script src="js/handlers/bookings-handlers.js"></script>
    
    <!-- 8. App principale (ultimo!) -->
    <script src="js/app.js"></script>
</body>
</html><!-- Aggiungi prima di </body> - Da integrare manualmente nella posizione corretta -->

<!-- MANUTENZIONE HTML DA COPIARE DOPO cleaningSection -->
<!--
            <div id="maintenanceSection" class="content-section">
                <div class="section-header">
                    <h1>üîß Manutenzione</h1>
                    <button class="btn btn-primary" id="addMaintenanceBtn">+ Aggiungi Intervento</button>
                </div>
                <div class="maintenance-stats">
                    <div class="stat-card-small"><h3>Da Programmare</h3><p class="stat-value" id="maintenancePending">0</p></div>
                    <div class="stat-card-small"><h3>In Corso</h3><p class="stat-value" id="maintenanceInProgress">0</p></div>
                    <div class="stat-card-small"><h3>üî¥ Urgenti</h3><p class="stat-value" id="maintenanceUrgent">0</p></div>
                    <div class="stat-card-small"><h3>Costo (30gg)</h3><p class="stat-value" id="maintenanceTotalCost">‚Ç¨0</p></div>
                </div>
                <div class="section-toolbar">
                    <input type="text" id="maintenanceSearch" class="form-control" placeholder="Cerca...">
                    <select id="maintenanceCategoryFilter" class="form-control"><option value="all">Tutte categorie</option><option value="plumbing">üö∞ Idraulica</option><option value="electrical">‚ö° Elettricit√†</option><option value="heating">üî• Riscaldamento</option><option value="locksmith">üîë Serrature</option><option value="appliances">üîß Elettrodomestici</option><option value="other">üõ†Ô∏è Altro</option></select>
                    <select id="maintenanceStatusFilter" class="form-control"><option value="all">Tutti</option><option value="pending">Da programmare</option><option value="in-progress">In corso</option><option value="completed">Completati</option></select>
                    <select id="maintenancePriorityFilter" class="form-control"><option value="all">Tutte</option><option value="urgent">üî¥ Urgente</option><option value="high">üü† Alta</option><option value="medium">üü° Media</option><option value="low">üîµ Bassa</option></select>
                </div>
                <div id="maintenanceList" class="items-list"></div>
            </div>
-->
